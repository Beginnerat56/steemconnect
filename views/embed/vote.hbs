<style type="text/css">
  body {
    margin: 0;
    padding: 0;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    font-size: 14px;
    color: #545454;
  }

  a {
    text-decoration: none;
  }

  .vote {
    vertical-align: center;
    display: flex;
    flex-direction: row;
    line-height: 20px;
    height: 20px;
  }

  .btn-vote {
    width: 20px;
    height: 20px;
  }

  .btn-vote circle {
    stroke: #8a8a8a;
    fill: none;
  }

  .btn-vote path {
    fill: #8a8a8a;
  }

  .btn-vote:hover circle {
    stroke: #121313;
    fill: none;
  }

  .btn-vote:hover path {
    fill: #121313;
  }

  .btn-vote.active circle {
    stroke: #4ba2f2;
    fill: #4ba2f2;
  }

  .btn-vote.active path {
    fill: #FFFFFF;
  }

  .count {
    height: 20px;
    margin-left: 4px;
  }
</style>

<div class="vote">
  <a id="vote" href="javascript:" class="btn-vote{{#if hasVote}} active{{/if}}">
    <svg enable-background="new 0 0 33 33" version="1.1" viewBox="0 0 33 33" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="Chevron_Up_Circle"><circle cx="16" cy="16" r="15" stroke="#121313" fill="none"></circle><path d="M16.699,11.293c-0.384-0.38-1.044-0.381-1.429,0l-6.999,6.899c-0.394,0.391-0.394,1.024,0,1.414 c0.395,0.391,1.034,0.391,1.429,0l6.285-6.195l6.285,6.196c0.394,0.391,1.034,0.391,1.429,0c0.394-0.391,0.394-1.024,0-1.414 L16.699,11.293z" fill="#121313"></path></g></svg>
  </a>
  <span class="count" id="counter">{{content.net_votes}}</span>
</div>

<script src="//cdn.steemjs.com/lib/latest/steemconnect.min.js"></script>

<script>
(function(d) {

  var username = '{{username}}',
    isAuth = {{#if isAuth}}true{{else}}false{{/if}},
    hasVote = {{#if hasVote}}true{{else}}false{{/if}},
    author = '{{author}}',
    permlink = '{{permlink}}',
    weight = '{{weight}}',
    referer = '{{referer}}',
    vote = d.getElementById('vote'),
    counter = d.getElementById('counter');

  steemconnect.init({
    app: 'steemconnect',
    baseURL: '{{domain}}',
  });

  vote.onclick = isAuth ? toggleVote : login;

  function login() {
    window.top.location.href = '/login?redirect_url=' + referer;
  }

  function toggleVote() {
    if (hasVote === false) {
      addVote();
      steemconnect.vote(username, author, permlink, weight, function (err, result) {
        if (!err) {
          hasVote = true;
        } else {
          removeVote();
        }
      });
    } else {
      removeVote();
      steemconnect.vote(username, author, permlink, 0, function (err, result) {
        if (!err) {
          hasVote = false;
        } else {
          addVote();
        }
      });
    }
  }

  function addVote() {
    vote.setAttribute('class', 'btn-vote active');
    counter.innerHTML = parseInt(counter.innerHTML) + 1;
  }

  function removeVote() {
    vote.setAttribute('class', 'btn-vote');
    counter.innerHTML = parseInt(counter.innerHTML) - 1;
  }

}(document));
</script>
